<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Simple Calendar App</title>
  <style>
    /* Basic reset */
    body, html {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: #fafafa;
    }

    #calendar-container {
      width: 90%;
      max-width: 600px;
      margin: 20px auto;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
    }

    .calendar-header {
      text-align: center;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .calendar-grid {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-wrap: wrap;
          -ms-flex-wrap: wrap;
              flex-wrap: wrap;
    }

    .day-header, .day-cell {
      width: 14.2857%; /* 100% / 7 days */
      box-sizing: border-box;
      text-align: center;
      border: 1px solid #ddd;
      min-height: 60px;
      padding: 4px;
      font-size: 14px;
    }

    .day-header {
      background: #f0f0f0;
      font-weight: bold;
    }

    .day-cell {
      vertical-align: top;
    }

    .day-number {
      font-weight: bold;
      margin-bottom: 5px;
      display: block;
    }

    .event {
      background: #e6f7ff;
      margin: 2px 0;
      padding: 2px;
      border-left: 3px solid #007bff;
      font-size: 12px;
      text-align: left;
    }
  </style>
</head>
<body>

<div id="calendar-container">
  <div id="calendar-header" class="calendar-header"></div>
  <div class="calendar-grid">
    <!-- Day Name Headers (Sun, Mon, etc.) -->
    <div class="day-header">Sun</div>
    <div class="day-header">Mon</div>
    <div class="day-header">Tue</div>
    <div class="day-header">Wed</div>
    <div class="day-header">Thu</div>
    <div class="day-header">Fri</div>
    <div class="day-header">Sat</div>
  </div>

  <!-- The grid of actual days (dates) will be inserted here by JS -->
  <div id="calendar-days" class="calendar-grid"></div>
</div>

<script>
/**
 * ======= CONFIGURATION =======
 * Replace these with your actual calendar ID and API key.
 */
var CALENDAR_ID = "ronward.english@gmail.com";
var API_KEY = "AIzaSyAJkLCd0IJ2dPxLeijCUO7HClOwSoy5j-Q";

/**
 * Create a simple monthly calendar and fetch events from Google Calendar.
 * This is set up for older iOS devices, so we're using ES5 syntax and XHR.
 */
(function() {
  // Get today's date
  var today = new Date();
  var currentYear = today.getFullYear();
  var currentMonth = today.getMonth(); // 0-based (0 = January)
  
  // Populate the header text (e.g., "January 2025")
  var headerEl = document.getElementById("calendar-header");
  var monthNames = [
    "January", "February", "March", "April", "May", "June", 
    "July", "August", "September", "October", "November", "December"
  ];
  headerEl.textContent = monthNames[currentMonth] + " " + currentYear;

  // Build the monthly calendar structure (empty boxes + date numbers)
  var calendarDaysEl = document.getElementById("calendar-days");
  // Clear any existing HTML
  calendarDaysEl.innerHTML = "";

  // Create a date for the first day of this month
  var firstDayOfMonth = new Date(currentYear, currentMonth, 1);
  // Find the day of the week the first day falls on (0=Sun, 1=Mon, etc.)
  var startDay = firstDayOfMonth.getDay();

  // Number of days in this month
  var daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

  // We need a total of (startDay) blank cells + (daysInMonth) real day cells
  // Then if the last day doesn't end on Saturday, we may add some blank cells at the end.
  
  // First, add blank cells for days before 1st of the month
  var i;
  for (i = 0; i < startDay; i++) {
    var blankCell = document.createElement("div");
    blankCell.className = "day-cell";
    calendarDaysEl.appendChild(blankCell);
  }

  // Next, add cells for each day of the month
  for (i = 1; i <= daysInMonth; i++) {
    var dayCell = document.createElement("div");
    dayCell.className = "day-cell";

    // Show the day number
    var dayNumber = document.createElement("span");
    dayNumber.className = "day-number";
    dayNumber.textContent = i;
    dayCell.appendChild(dayNumber);

    calendarDaysEl.appendChild(dayCell);
  }

  /**
   * Now fetch events from Google Calendar for the current month.
   * Weâ€™ll filter events to only show those within this month.
   */
  var startDate = new Date(currentYear, currentMonth, 1);
  var endDate = new Date(currentYear, currentMonth + 1, 0, 23, 59, 59);

  // Format to RFC3339 for Google API:
  // e.g., 2025-01-01T00:00:00Z
  function toRFC3339(dateObj) {
    return dateObj.getFullYear() + "-" +
      pad(dateObj.getMonth() + 1) + "-" +
      pad(dateObj.getDate()) + "T" +
      pad(dateObj.getHours()) + ":" +
      pad(dateObj.getMinutes()) + ":" +
      pad(dateObj.getSeconds()) + "Z";
  }

  function pad(num) {
    return (num < 10 ? "0" : "") + num;
  }

  var timeMin = toRFC3339(startDate);
  var timeMax = toRFC3339(endDate);

  var url = "https://www.googleapis.com/calendar/v3/calendars/" + 
            encodeURIComponent(CALENDAR_ID) + 
            "/events?key=" + API_KEY + 
            "&timeMin=" + timeMin + 
            "&timeMax=" + timeMax + 
            "&singleEvents=true&orderBy=startTime";

  // Use XHR instead of fetch to support older iOS Safari
  var xhr = new XMLHttpRequest();
  xhr.open("GET", url, true);
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4 && xhr.status === 200) {
      var data = JSON.parse(xhr.responseText);
      if (data && data.items) {
        renderEvents(data.items);
      }
    }
  };
  xhr.send();

  /**
   * Renders events in the calendar.
   * items - an array of events from the Google Calendar API.
   */
  function renderEvents(items) {
    // We'll iterate over each event, parse the date, then find the right cell to insert it into.
    for (var i = 0; i < items.length; i++) {
      var ev = items[i];
      var startStr = ev.start.date || ev.start.dateTime;  // date if all-day, dateTime otherwise
      // Convert to JS Date
      var eventDate = new Date(startStr);
      var day = eventDate.getDate();

      // The day-cell for day X is offset by startDay + X - 1 in the .calendar-grid
      var cellIndex = startDay + day - 1;
      var dayCells = calendarDaysEl.getElementsByClassName("day-cell");

      if (cellIndex >= 0 && cellIndex < dayCells.length) {
        var eventEl = document.createElement("div");
        eventEl.className = "event";
        eventEl.textContent = ev.summary || "(No title)";
        dayCells[cellIndex].appendChild(eventEl);
      }
    }
  }

})();
</script>

</body>
</html>
