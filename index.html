<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <!-- Force width and height for older iPad screens -->
  <meta name="viewport" content="width=1024, initial-scale=1.0">
  <title>Multi-Calendar App</title>
  <style>
    /* Force 1024×768 layout to match iPad's older screens */
    html, body {
      margin: 0;
      padding: 0;
      width: 1024px;
      height: 768px;
      background: #fafafa;
    }

    #calendar-container {
      width: 1024px;
      height: 768px;
      margin: 0 auto; /* center horizontally if possible */
      background: #fff;
      border: 1px solid #ccc;
      box-sizing: border-box;
      overflow: hidden; /* hide any overflow if we exceed bounds */
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: vertical;
      -webkit-box-direction: normal;
          -ms-flex-direction: column;
              flex-direction: column;
    }

    .calendar-header {
      text-align: center;
      font-weight: bold;
      padding: 10px 0;
      border-bottom: 1px solid #ccc;
    }

    .calendar-grid {
      /* Use the remaining space for the grid */
      -webkit-box-flex: 1;
          -ms-flex: 1;
              flex: 1;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: vertical;
      -webkit-box-direction: normal;
          -ms-flex-direction: column;
              flex-direction: column;
    }

    .day-row {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-flex: 1;
          -ms-flex: 1;
              flex: 1;
    }

    .day-header, .day-cell {
      -webkit-box-flex: 1;
          -ms-flex: 1;
              flex: 1;
      box-sizing: border-box;
      text-align: center;
      border: 1px solid #ddd;
      font-size: 14px;
      position: relative;
    }

    .day-header {
      background: #f0f0f0;
      font-weight: bold;
      height: 35px;
      line-height: 35px;
    }

    .day-cell {
      vertical-align: top;
      /* If needed, adjust font-size or spacing to ensure everything fits */
    }

    .day-number {
      font-weight: bold;
      display: block;
      margin: 2px;
    }

    /* A generic event box; we'll override background color in JS. */
    .event {
      margin: 2px auto;
      padding: 2px 4px;
      border-radius: 4px;
      font-size: 12px;
      color: #fff; /* White text on colored background */
      text-align: center;
      width: 80%; /* Slightly narrower than cell width */
    }
  </style>
</head>
<body>

<div id="calendar-container">
  <!-- Calendar Title -->
  <div id="calendar-header" class="calendar-header"></div>

  <!-- Day Name Headers (Sun, Mon, Tue, etc.) -->
  <div class="day-row">
    <div class="day-header">Sun</div>
    <div class="day-header">Mon</div>
    <div class="day-header">Tue</div>
    <div class="day-header">Wed</div>
    <div class="day-header">Thu</div>
    <div class="day-header">Fri</div>
    <div class="day-header">Sat</div>
  </div>

  <!-- Main grid for the days of the month -->
  <div id="calendar-days" class="calendar-grid"></div>
</div>

<script>
/**
 * ======= CONFIGURATION =======
 * We’ll store multiple calendars, each with an ID, a label, and a color.
 * Make sure these Google Calendars are publicly accessible, or handle OAuth separately.
 */
var CALENDARS = [
  {
    id: "ronward.english@gmail.com",
    label: "BS",
    color: "blue"
  },
  {
    id: "c_1au77uvsbhjjkbbn0u0o1nvfdo@group.calendar.google.com",
    label: "杉並",
    color: "orange"
  }
];

// Replace with your Google API key
var API_KEY = "AIzaSyAJkLCd0IJ2dPxLeijCUO7HClOwSoy5j-Q";

/**
 * Create a simple monthly calendar and fetch events from multiple Google Calendars.
 * This is set up for older iOS devices, so we use ES5 syntax and XHR.
 */
(function() {
  // 1) Basic date info
  var today = new Date();
  var currentYear = today.getFullYear();
  var currentMonth = today.getMonth(); // 0-based (0 = Jan)

  // 2) Populate the header text (e.g., "January 2025")
  var headerEl = document.getElementById("calendar-header");
  var monthNames = [
    "January", "February", "March", "April", "May", "June", 
    "July", "August", "September", "October", "November", "December"
  ];
  headerEl.textContent = monthNames[currentMonth] + " " + currentYear;

  // 3) Build the calendar grid (rows and columns for each day)
  //    - We’ll have at most 6 rows of 7 days (42 cells total).
  var calendarDaysEl = document.getElementById("calendar-days");
  calendarDaysEl.innerHTML = ""; // Clear old data if any

  // Make a date for 1st of the month
  var firstDayOfMonth = new Date(currentYear, currentMonth, 1);
  var startDay = firstDayOfMonth.getDay(); // 0=Sun, 1=Mon, etc.

  // Days in this month
  var daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

  // We can calculate how many total slots we need (up to 42).
  var totalCells = 42; // 6 weeks × 7 days
  var dayCount = 1;

  // Create up to 6 rows
  for (var row = 0; row < 6; row++) {
    var rowEl = document.createElement("div");
    rowEl.className = "day-row";

    // Each row has 7 cells
    for (var col = 0; col < 7; col++) {
      var cellIndex = row * 7 + col;
      var dayCell = document.createElement("div");
      dayCell.className = "day-cell";

      // If cellIndex >= startDay and dayCount <= daysInMonth, we have a real date
      if (cellIndex >= startDay && dayCount <= daysInMonth) {
        // Display the day number
        var dayNumber = document.createElement("span");
        dayNumber.className = "day-number";
        dayNumber.textContent = dayCount;
        dayCell.appendChild(dayNumber);

        // Store a data attribute so we can place events easily
        dayCell.setAttribute("data-day", dayCount);

        dayCount++;
      }
      rowEl.appendChild(dayCell);
    }
    calendarDaysEl.appendChild(rowEl);
  }

  // 4) We’ll fetch events for each calendar
  var startDate = new Date(currentYear, currentMonth, 1);
  var endDate = new Date(currentYear, currentMonth + 1, 0, 23, 59, 59);

  // Format to RFC3339
  function toRFC3339(dateObj) {
    return dateObj.getFullYear() + "-" +
      pad(dateObj.getMonth() + 1) + "-" +
      pad(dateObj.getDate()) + "T" +
      pad(dateObj.getHours()) + ":" +
      pad(dateObj.getMinutes()) + ":" +
      pad(dateObj.getSeconds()) + "Z";
  }
  function pad(num) { return (num < 10 ? "0" : "") + num; }

  var timeMin = toRFC3339(startDate);
  var timeMax = toRFC3339(endDate);

  // We’ll loop over our CALENDARS array and fetch events for each
  for (var i = 0; i < CALENDARS.length; i++) {
    fetchCalendarEvents(CALENDARS[i], timeMin, timeMax);
  }

  /**
   * Fetches events for one calendar using XHR.
   * @param {Object} calendarObj - An object with { id, label, color }
   * @param {string} timeMin
   * @param {string} timeMax
   */
  function fetchCalendarEvents(calendarObj, timeMin, timeMax) {
    var url = "https://www.googleapis.com/calendar/v3/calendars/" +
              encodeURIComponent(calendarObj.id) +
              "/events?key=" + API_KEY +
              "&timeMin=" + timeMin +
              "&timeMax=" + timeMax +
              "&singleEvents=true&orderBy=startTime";

    var xhr = new XMLHttpRequest();
    xhr.open("GET", url, true);
    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4 && xhr.status === 200) {
        var data = JSON.parse(xhr.responseText);
        if (data && data.items) {
          renderEvents(data.items, calendarObj.label, calendarObj.color);
        }
      }
    };
    xhr.send();
  }

  /**
   * Render events onto the calendar.
   * @param {Array} items - Array of Google Calendar event objects
   * @param {string} label - The short label to display (e.g., "BS" or "TM")
   * @param {string} color - The color to use (e.g., "blue" or "orange")
   */
  function renderEvents(items, label, color) {
    for (var i = 0; i < items.length; i++) {
      var ev = items[i];
      var startStr = ev.start.date || ev.start.dateTime; // If all-day, "date"; otherwise "dateTime"
      var eventDate = new Date(startStr);
      var day = eventDate.getDate();

      // Find the cell with data-day = day
      var dayCells = document.querySelectorAll('[data-day="' + day + '"]');

      // If such a cell exists, append an event element
      if (dayCells.length > 0) {
        var eventEl = document.createElement("div");
        eventEl.className = "event";
        eventEl.textContent = label;         // Use the specified label
        eventEl.style.backgroundColor = color; // Set background to the chosen color
        dayCells[0].appendChild(eventEl);
      }
    }
  }

})();
</script>

</body>
</html>
